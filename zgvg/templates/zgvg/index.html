{% extends 'base.html' %}
{% load static babel_transpiling %}
{% block title %}ZGVG Gallery{% endblock %}
{% block sw_url %}{% url "zgvg:sw.js" %}{% endblock %}
{% block style %}
  <style type="text/css">
    .ui.header {
      display: table;
    }
    dialog {
      padding: 0;
      border: 0;
    }
  </style>
{% endblock %}
{% block container %}
  <div id="root"></div>
  <div id="modal"></div>
{% endblock %}
{% block script %}
  <script src="https://cdn.jsdelivr.net/npm/dshell@1.4.0/dep.bundle.min.js"></script>
  {% if debug %}
    <script src="https://cdn.jsdelivr.net/npm/react@17.0.1/umd/react.development.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@17.0.1/umd/react-dom.development.js" crossorigin></script>
  {% else %}
    <script src="https://cdn.jsdelivr.net/npm/react@17.0.1/umd/react.production.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@17.0.1/umd/react-dom.production.min.js" crossorigin></script>
  {% endif %}
  <script type="module">
  (async () => {
    const root = document.querySelector('#root')
    const fallback = async (error) => {
      if (root.children.length) {
        return
      }
      // 白屏
      const AppHelper = (await import('{% static "zgvg/js/app-helper.jsx" %}')).default
    {% transpiling %}
      ReactDOM.render(<AppHelper error={error}/>, root)
    {% endtranspiling %}
    }
    window.onerror = (message, file, line, column, error) => fallback(error)

    try {
      const App = (await import('{% static "zgvg/js/index.jsx" %}')).default
    {% transpiling %}
      ReactDOM.render(<App/>, root)
    {% endtranspiling %}
    } catch (error) {
      fallback(error)
    }
  })()
  </script>
{% endblock %}
